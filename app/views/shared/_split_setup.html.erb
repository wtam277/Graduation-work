<!-- „Ç™„É≥„Ç™„ÉïÂàá„ÇäÊõø„Åà„Éú„Çø„É≥ -->

<button id="toggle-split-btn">2ÁîªÈù¢Ë°®Á§∫ON</button>


<!-- 2ÁîªÈù¢„ÇíË°®Á§∫„Åô„Çã„Åü„ÇÅ„ÅÆ„É©„ÉÉ„Éë„Éº -->
<div id="split-wrapper" style="display: none;">
  <div id="left-pane">
    <iframe src="<%= request.fullpath %>" frameborder="0"></iframe>
  </div>
  <div id="right-pane">
    <iframe src="<%= comic_story_maps_path(@comic) %>" frameborder="0"></iframe>
  </div>
</div>




<style>

  #split-wrapper {
    height: 90vh;
    display: flex;
  }

  #split-wrapper > div {
    height: 100%;
  }

  #left-pane, #right-pane {
    overflow: hidden;
  }

  iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  .gutter {
    background-color: #ccc;
    background-repeat: no-repeat;
    background-position: 50%;
  }

  .gutter.gutter-horizontal {
    cursor: col-resize;
    width: 8px;
  }

  .gutter.gutter-vertical {
    cursor: row-resize;
    height: 8px;
  }
</style>

<script>
  let splitInstance = null;

  document.addEventListener("turbo:load", () => {
    const button = document.getElementById("toggle-split-btn");
    const wrapper = document.getElementById("split-wrapper");
    const mainContent = document.getElementById("main-content");
    const pageHeader = document.getElementById("page-header");
    const pageFooter = document.getElementById("page-footer");

    // üëá iframeÂÜÖ„Å†„Å£„Åü„Çâ„Éò„ÉÉ„ÉÄ„Éº„Å®„Éú„Çø„É≥„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
    if (window.self !== window.top) {
      const header = document.querySelector("header");
      if (button) button.style.display = "none";
      if (header) header.style.display = "none";
      return;
    }

    // ‚úÖ ÂàÜÂâ≤Áä∂ÊÖã„ÇíÂæ©ÂÖÉ„Åô„ÇãÈñ¢Êï∞
    function enableSplitView() {
      if (wrapper) wrapper.style.display = "flex";
      if (mainContent) mainContent.style.display = "none";
      if (pageFooter) pageFooter.style.display = "none";
      if (pageHeader) pageHeader.style.display = "none";
      if (button) button.textContent = "2ÁîªÈù¢Ë°®Á§∫OFF";

      if (!splitInstance) {
        splitInstance = Split(['#left-pane', '#right-pane'], {
          sizes: [50, 50],
          minSize: 200,
          gutterSize: 8
        });
      }
    }

    // ‚úÖ ÂàÜÂâ≤„ÇíËß£Èô§„Åô„ÇãÈñ¢Êï∞
    function disableSplitView() {
      if (wrapper) wrapper.style.display = "none";
      if (mainContent) mainContent.style.display = "block";
      if (pageHeader) pageHeader.style.display = "block";
      if (pageFooter) pageFooter.style.display = "block";
      if (button) button.textContent = "2ÁîªÈù¢Ë°®Á§∫ON";
      
        location.reload();

      localStorage.setItem("splitViewEnabled", "false");
    }

    // ‚úÖ Áä∂ÊÖã„Å´Âøú„Åò„Å¶Âæ©ÂÖÉ
    const savedState = localStorage.getItem("splitViewEnabled");
    if (savedState === "true") {
      enableSplitView();
    }

    // ‚úÖ „Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„ÅßÁä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà
    button.addEventListener("click", () => {
      const isCurrentlyEnabled = localStorage.getItem("splitViewEnabled") === "true";

      if (isCurrentlyEnabled) {
        disableSplitView();
      } else {
        enableSplitView();
        localStorage.setItem("splitViewEnabled", "true");
      }
    });
  });
</script>