<h1>ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€ç°¡æ˜“4ã‚³ãƒã§ã™</h1>

<% comic = Comic.find(params[:comic_id]) %>

<p>ï¼œèµ·ï¼: <%= comic.story_parts.where(part_type: 0).order(created_at: :desc).first&.content || "ãªã—" %></p>

<div class="note-button">
  <button type="button" class="add-note" data-comic-id="<%= @comic.id %>" data-notable-type="panel">ï¼‹</button>
</div>

<!-- ä»˜ç®‹ã®ã‚³ãƒ³ãƒ†ãƒŠ -->
<div id="note-container">
<% @stiky_notes.each do |note| %>
  <div class="note"
       style="left: <%= note.position_x %>px; top: <%= note.position_y %>px;"
       data-id="<%= note.id %>"
       data-comic-id="<%= @comic.id %>">
    <textarea oninput="updateNoteContent(this)"><%= note.note_content %></textarea>
  </div>
<% end %>
</div>

<% (1..4).each_slice(1) do |group| %>
  <div class="storage-container">
    <% group.each do |position| %>
      <% panel = @comic.panels.find_by(position: position) %>
      <div class="storage-box">
        <div class="position-number"><%= position %></div>
        <div class="panel-content">
          <% if panel.present? %>
            <!--  Location -->
            <% if panel.locations.any? %>
              <p><strong>ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼š</strong> <%= panel.locations.map(&:location_name).join(", ") %></p>
            <% else %>
              <p>ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±ãªã—</p>
            <% end %>

            <!-- ã‚»ãƒªãƒ•ã®è¡¨ç¤º -->
            <% if panel.speeches.any? %>
            
            <% panel.speeches.order(:position).each do |speech| %>
              <p>
                <% if speech.character&.icon&.attached? %>
                  <%= image_tag url_for(speech.character.icon), size: "30x30", alt: "ã‚­ãƒ£ãƒ©ã‚¢ã‚¤ã‚³ãƒ³", style: "vertical-align: middle; margin-right: 8px;" %>
                <% end %>
                <strong><%= speech.character.name if speech.character %>:</strong>
                <%= speech.content %>
              </p>
            <% end %>
          <% else %>
            <p>ã‚»ãƒªãƒ•ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</p>
          <% end %>

            <%= link_to "ç·¨é›†", edit_comic_panel_path(@comic, panel), class: "edit-button" %>
          <% else %>
            <!-- ãƒ‘ãƒãƒ«æœªä½œæˆ -->
            <p>ã¾ã ä½œæˆã—ã¦ã„ã¾ã›ã‚“</p>
            <%= link_to "æ–°è¦ä½œæˆ", new_comic_panel_path(@comic, position: position), class: "create-button" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<p>ï¼œæ‰¿ï¼: <%= comic.story_parts.where(part_type: 1).order(created_at: :desc).first&.content || "ãªã—" %></p>
<p>ï¼œè»¢ï¼: <%= comic.story_parts.where(part_type: 2).order(created_at: :desc).first&.content || "ãªã—" %></p>
<p>ï¼œçµï¼: <%= comic.story_parts.where(part_type: 3).order(created_at: :desc).first&.content || "ãªã—" %></p>


<style>
.storage-container {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.storage-box {
  position: relative;
  background-color: #6bb7ff;
  padding: 20px;
  border-radius: 10px;
  width: 300px;
  height: 170px;

  /* ğŸ‘‡è¿½åŠ ï¼šãƒœãƒƒã‚¯ã‚¹é–“ã«ä½™ç™½ã‚’ä½œã‚‹ */
  margin-bottom: 10px;
}

.position-number {
  position: absolute;
  top: 10px;
  left: 10px;
  background-color: #a8e6cf; /* ç·‘ */
  padding: 5px 10px;
  font-weight: bold;
  border-radius: 5px;
}

.panel-content {
  text-align: center;
  margin-top: 30px;
}

.create-button {
  display: block;
  margin: 10px auto;
  background-color: gray;
  color: white;
  padding: 10px;
  text-align: center;
  border-radius: 5px;
}

.note-button {
  width: 50px;
  text-align: center;
}

.add-note {
  background-color: #ffcc00;
  border: none;
  font-size: 20px;
  padding: 5px 10px;
  cursor: pointer;
  border-radius: 5px;
}

.note {
  width: 150px;
  height: 100px;
  background-color: yellow;
  position: absolute;
  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  border: 1px solid #ccc;
  padding: 5px;
  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
}

.note textarea {
  width: 100%;
  height: 100%;
  border: none;
  padding-top: 20px;
  background: transparent;
  font-size: 14px;
  resize: none;
  outline: none;
  text-align: left;
}

.delete-note-btn {
  position: absolute;
  top: 2px;
  right: 5px;
  border: none;
  background: transparent;
  font-size: 16px;
  cursor: pointer;
  color: black;
}
</style>